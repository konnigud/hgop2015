var should = require('should');

module.exports = function tictactoeCommandHandler(events){
    var gameCreatedEvent = events;

    var handlers = {
        "CreateGame":function(cmd){
            var newGame={
                id:cmd.id,
                playerOne:cmd.userName,
                createTimeStamp:cmd.timeStamp,
                name:cmd.name,
            };
            gameCreatedEvent.push(cmd);
            return [{
                id: cmd.id,
                event: "GameCreated",
                gameId: gameCreatedEvent.length,
                userName: cmd.userName,
                timeStamp: cmd.timeStamp,
                name: cmd.name
            }];
        },
        "JoinGame":function(cmd){
            if(gameCreatedEvent===undefined || gameCreatedEvent.length <= 0){
                return [{
                    id:cmd.id,
                    event:"GameDoesNotExist",
                    userName: cmd.userName,
                    timeStamp: cmd.timeStamp
                }];
            }
            var game = gameCreatedEvent[cmd.gameId-1];
            if(game.playerTwo===undefined) {
                game.playerTwo = cmd.userName;
                return [{
                    id: cmd.id,
                    event: "GameJoined",
                    playerOne: game.playerOne,
                    playerTwo: game.playerTwo,
                    timeStamp: cmd.timeStamp
                }];
            }
            return[{
                id:cmd.id,
                event:"GameIsFull",
                userName:cmd.userName,
                timeStamp:cmd.timeStamp
            }];
        }
    };

    return {
        executeCommand:function(cmd){
            return handlers[cmd.comm](cmd);
        }
    };
}